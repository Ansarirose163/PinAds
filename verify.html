<!DOCTYPE html>
<html>
<head>
  <title>Verification</title>
  <script>
    async function verifyUser() {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");

      // Decode JWT token (basic)
      const payload = JSON.parse(atob(token.split('.')[1]));
      const deviceId = payload.deviceId;

      // Call Netlify function to mark as verified
      const res = await fetch("/.netlify/functions/updateVerification", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ deviceId })
      });

      const data = await res.json();
      if (data.success) {
        document.getElementById("msg").innerText = "✅ Verification Success!";
      } else {
        document.getElementById("msg").innerText = "❌ Verification Failed!";
      }
    }

    window.onload = verifyUser;
  </script>
</head>
<body>
  <h1 id="msg">⏳ Verifying...</h1>
</body>
</html>
